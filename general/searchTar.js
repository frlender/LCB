var blockUIcss={border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:0.5,color:"#fff"};$(document).ready(function(){$("#upTable").dataTable({aaSorting:[],aoColumns:[{sTitle:"Overlap",sClass:"center"},{sTitle:"Info (Perturbation, Dose, Time, Cell, Batch)"}]});d3.selectAll("label").remove();$.get(domainAddr+"getCount.php",function(a){d3.select("#searchCounter").text(a)})});var g_upCheck=false;var g_dnCheck=false;var g_reverse=false;var g_Aggr_reverse_label="Aggravate";var progressCall;var signature;var domainAddr="http://www.maayanlab.net/LINCS/test/execuTest/";var purl=domainAddr+"progressTotal.php";var eurl=domainAddr+"emptySignature.php";var callStopped=true;function textEmpty(a){if(d3.select("#"+a+"List").property("value")){d3.select("#"+a+"Check").attr("disabled",null)}else{d3.select("#"+a+"Check").attr("disabled","disabled");$("#"+a+"Check").prop("checked",false);checkit(a)}}function checkit(a){if(a=="up"){g_upCheck=d3.select("#upCheck").property("checked")}else{g_dnCheck=d3.select("#dnCheck").property("checked")}if(g_upCheck||g_dnCheck){d3.select("input[value=Search][type=button]").classed("myInactiveButton",false).classed("myButton",true);$("input[value=Search][type=button]").unbind("click");$("input[value=Enrichr]").unbind("click");$("input[value=Search][type=button]").click(function(){sendGenes()});$("input[value=Enrichr]").click(function(){enrichrIt()});d3.select("input[value=Enrichr]").classed("myInactiveButton",false).classed("myButton",true)}else{d3.select("input[value=Search][type=button]").classed("myButton",false).classed("myInactiveButton",true);$("input[value=Search][type=button]").unbind("click");$("input[value=Enrichr]").unbind("click");d3.select("input[value=Enrichr]").classed("myButton",false).classed("myInactiveButton",true)}}function sendGenes(){var c=d3.select("#dnList").property("value");var d=d3.select("#upList").property("value");d=$.trim(d).toUpperCase();c=$.trim(c).toUpperCase();g_Aggr_reverse_label="Aggravate";if(g_reverse){var a=c;c=d;d=a;g_Aggr_reverse_label="reverse"}signature="temp_"+Math.random().toString(36).substring(7);var b;if(g_upCheck&&g_dnCheck){b=domainAddr+"updn.php";post2php(b,{upgenes:d,dngenes:c,signature:signature},"(Up/Down/"+g_Aggr_reverse_label+")");progressCall=setInterval(function(){getProgress(signature)},1000)}else{if((g_upCheck&&g_Aggr_reverse_label=="Aggravate")||(g_dnCheck&&g_Aggr_reverse_label=="reverse")){b=domainAddr+"up.php";post2php(b,{upgenes:d,signature:signature},"(Up/"+g_Aggr_reverse_label+")");progressCall=setInterval(function(){getProgress(signature)},1000)}else{b=domainAddr+"dn.php";post2php(b,{dngenes:c,signature:signature},"(Down/"+g_Aggr_reverse_label+")");progressCall=setInterval(function(){getProgress(signature)},1000)}}}function post2php(b,d,a){$.blockUI({css:blockUIcss,message:"Please waiting for server response...."});var c;switch(a){case"(Up/Down)":c="149, 984";break;default:c="74, 992"}callStopped=false;$.ajax({type:"POST",url:b,data:d,dataType:"text",timeout:1200000,success:function(f){callStopped=true;clearInterval(progressCall);emptySignature(d.signature);try{res=JSON.parse(f);d3.select(".blockMsg").text(c+" gene lists compared !");setTimeout(function(){$.unblockUI()},1500);currentCount=parseInt(res[2])+1;console.log(currentCount);d3.select("#searchCounter").text(currentCount.toString())}catch(e){d3.select(".blockMsg").text("Please retry, error as:"+f)}d3.select("#header_suffix").text(a);addLinks(res,"up")},error:function(f,e,g){console.log("error begin");console.log(f.status);console.log(g);console.log(e);console.log("error end")}})}function getProgress(a){$.post(purl,{signature:a},function(c){if(callStopped){return}var b=Math.round(parseFloat(c)*100);d3.select(".blockMsg").text("Processing.... "+b+"% complete")})}function emptySignature(a){$.post(eurl,{signature:a})}function addLinks(e,b){var k=Object.keys(e[0]);var g=e[0];var a=e[1];var h=[];for(key in g){h.push([g[key],a[key],key])}h.sort();h.reverse();var d={};d.aaData=[];for(i in h){var c=h[i][1];var f='<a href="index.html?id='+h[i][2]+'" target="_blank">'+h[i][1]+"</a>";d.aaData.push([h[i][0].toFixed(4),f])}d.aoColumns=[{sTitle:"Overlap",sClass:"center"},{sTitle:"Info (Perturbation, Dose, Time, Cell, Batch)"}];if(d3.select("#"+b+"Table_wrapper").empty()){var j=$("#"+b+"Table").dataTable(d);j.fnSort([[0,"desc"]]);j.fnAdjustColumnSizing();d3.selectAll("label").remove()}else{var j=$("#"+b+"Table").dataTable();j.fnClearTable();j.fnAddData(d.aaData);j.fnSort([[0,"desc"]]);j.fnAdjustColumnSizing()}}function clearText(a){d3.select("#"+a+"List").property("value","");textEmpty(a)}function example(){var b="MTF2\nSYNCRIP\nSLPI\nMRPL19\nCOX17\nKIAA0494\nC7ORF42\nANKS1A\nPSMB4\nAREG\nELOVL6\nCSTF2T\nCYR61\nUGT2B28\nSEC63\nHDGFRP3\nEFS\nPER1\nMNAT1\nPDZD8\nADRB2\nEFS\nCDCA4\nMAPK1IP1L\nKCNJ15\nPELI1\nZC3H12A\nRAB11FIP2\nITSN2\nGLDC\nCYB5R2\nMFAP5\nH1F0\nMYH10\nHDDC2\nSERHL2\nSERHL2\nBECN1\nPER1\nCOX7C\nZNF589\nTGFBR2\nIDE\nADO\nNME7\nFAM158A\nMIF\nLIMCH1\nIDE\nPOLR1E\nLMNB1\nEIF5\nRBM12\nCHIC2\nALDH3B2\nFXYD5\nLAMC2\nANKRD27\nUSP7\nPXMP2\nCOX6B1\nSTAMBP\nPLP2\nCASC3\nSNRPF\nTOMM34\nRPA1\nKCNK1\nRFX5\nELOVL1\nNDUFB4\nARHGEF5\nSUV39H1\nRAB21\nLBR\nTFRC\nAP2S1\nDLD\nRPA1\nTES\nELOVL1\nHDAC2\nGTF2A2\nPRSS23\nTUBA4A\nGAPDH\nG6PD\nTES\nDDX3Y\nCXCL2\nCLTB\nPOLR2I\nCLTB\nCLTB\n";var a="SYNGR3\nCDH3\nNCK1\nTKTL1\nNUSAP1\nBAG3\nNR2F6\nNCK1\nPCNA\nTUBD1\nKIF5C\nRAB27A\nETV1\nAPPBP2\nTSPAN4\nRAB27A\nAPPBP2\nETV1\nXIST\nXIST\nSIRT3\nGATAD1\nNPDC1\nBTN3A2\nVPS28\nSATB1\nCETN3\nPRPF4\nSMC1A\nRAB31\nAPPBP2\nTAPBP\nETV1\nNOL7\nRXRB\nETV1\nBTN3A1\nCHAD\nC16ORF58\nETV1\nEMR2\nPAK1\nCTNNAL1\nPOMT1\nC6ORF62\nHEATR6\nNHEJ1\nUBE3B\nPRKAB1\nDNAJC12\nAMDHD2\nZKSCAN5\nPDE3B\nNVL\nBTN3A2\nPDE3B\nNUMA1\nVAMP3\nCDC45\nABHD4\nFBXW2\nFAM134B\nFLOT1\nVAMP3\nCLSTN2\nZMYM5\nITGAL\nTNFRSF14\nSIK2\nTSPAN7\nRSF1\nSLC7A11\nALG8\nLOC730101\nPEX1\nUSP20\nDEAF1\nC11ORF30\nPSMB8\nCSPG5\nST6GALNAC2\nDCAF8\nPPM1D\nP2RX4\nIL6R\nFNTB\nFBXO38\nYME1L1\nBAALC\nITGAE\nAHI1\nTADA2A\nCDC25C\nUSP10\nAGA\n";d3.select("#upList").property("value",a);d3.select("#dnList").property("value",b);d3.select("#upCheck").attr("disabled",null);d3.select("#dnCheck").attr("disabled",null)}function enrichrIt(){var b=d3.select("#dnList").property("value");var e=d3.select("#upList").property("value");var d=RegExp("[^\\w\\n]");while(d.test(b[b.length-1])){b=b.trimRight()}while(d.test(e[e.length-1])){e=e.trimRight()}var f=" (Aggravate)";if(g_reverse){var a=b;b=e;e=a;f=" (Reverse)"}if(g_upCheck&&g_dnCheck){var c=e+b;alert("Up list and down list are combined as one list to Enrichr!");enrich({list:c,description:"Up/Down List"})}else{if(g_upCheck){enrich({list:e,description:"Up List"+f})}else{enrich({list:b,description:"Down List"+f})}}}function enrich(d){var a={description:"",popup:false};if(typeof d.description=="undefined"){d.description=a.description}if(typeof d.popup=="undefined"){d.popup=a.popup}if(typeof d.list=="undefined"){alert("No genes defined.")}var e=document.createElement("form");e.setAttribute("method","post");e.setAttribute("action","http://amp.pharm.mssm.edu/Enrichr/enrich");e.setAttribute("target","_blank");e.setAttribute("enctype","multipart/form-data");var b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name","list");b.setAttribute("value",d.list);e.appendChild(b);var c=document.createElement("input");c.setAttribute("type","hidden");c.setAttribute("name","description");c.setAttribute("value",d.description);e.appendChild(c);document.body.appendChild(e);e.submit();document.body.removeChild(e)};